#!/usr/bin/env groovy

def version
def serviceName

pipeline {
    agent any 
	environment {
		dotnet = 'C:\\Program Files (x86)\\dotnet\\'
	}
	
    stages {
        stage('Initialize') {
            steps {
				script {
					echo 'Dev-branch- Jenkinsfile practice - Hello world! - triggered by web hooks' 
					version = "${env.GIT_COMMIT[0..6]}-${env.BUILD_NUMBER}"
					serviceName = env.GIT_URL.replace(/^.*\/([^\/]+?).git$/, '$1')
					echo 'version' + version
					echo 'serviceName' + serviceName
				}
            }
        }
		
		stage('Checkout'){
			steps {
				git credentialsId: 'ASHRITH', url: 'https://github.com/mookkaiah/microservice-dotnetcore.git', branch: 'dev'
				echo 'Dev-branch- successfully checked out' 
			}
		}
		
		stage('Restore packages'){
			steps{
				bat "dotnet restore mathservice.csproj"
				echo 'Dev-branch- successfully restored' 
			}
		}
		
		stage('Clean'){
			steps{
				bat "dotnet clean mathservice.csproj"
				echo 'Dev-branch- successfully get cleaned' 
			}
		}
		
		stage('Build'){
			steps{
				bat "dotnet build mathservice.csproj --configuration Release"
				echo 'Dev-branch- successfully built' 
			}
		}
		
		stage('Stage final') {
            steps {
                echo 'Dev-branch- deployment completed' 
            }
        }
    }
}